{% extends "navbase.html" %}
{% import "macros.html" as macros %}
{% block muen %}
  <div class="side">
    <ul class="nav nav-sidebar">
      <li id="passwd" class="{{ idclass['passwd'][0] }}"><a href="#">修改密码</a></li>
      <li id="register" class="{{ idclass['register'][0] }}"><a href="#">添加用户</a></li>
      <li id ="edituser" class="{{ idclass['edituser'][0] }}"><a href="#">管理用户</a></li>
    </ul>
  </div>
{% endblock %}
{% block content %}
  <div id="register" class="{{ idclass['register'][1] }}">
      {# 使用Permission[current_user.role] 实现了类似 getattr(Permission, current_user.role) 的方法 #}
      {% if Permission[current_user.role] >=  Permission.ADMIN %}
        <h3 class="page-header">添加用户</h3>
        <form class="form-horizontal" method="post">
          {{ register_form.hidden_tag() }}
          {% for form in register_form %}
            {% if form != register_form.csrf_token %}
              <div class="form-group">
                {{ form.label(class="col-sm-2 control-label") }}
                <div class="col-sm-3">
                  {{ form(class="form-control")}}
                </div>
              </div>
            {% endif %}
          {% endfor %}
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="submit" name="action" value="register" class="btn btn-success">确认提交</button>
            </div>
          </div>
        </form>
      {% else %}
        <div class="alert alert-info" role="alert">提示：当前用户没有权限</div>
      {% endif %}
  </div>
  <div id="passwd" class="{{ idclass['passwd'][1] }}">
    <h3 class="page-header">修改密码</h3>
     <form class="form-horizontal" method="post">
       {{ passwd_form.hidden_tag() }}
       {% for form in passwd_form %}
         {% if form != passwd_form.csrf_token %}
           <div class="form-group">
             {{ form.label(class="col-sm-2 control-label") }}
             <div class="col-sm-3">
               {{ form(class="form-control")}}
             </div>
           </div>
         {% endif %}
       {% endfor %}
       <div class="form-group">
         <div class="col-sm-offset-2 col-sm-10">
           <button type="submit" name="action" value="passwd" class="btn btn-success">确认提交</button>
         </div>
       </div>
     </form>
  </div>
  <div id="edituser" class="{{ idclass['edituser'][1] }}">
  {% if Permission[current_user.role] >=  Permission.ADMIN %}
    {{ macros.render_search(thead, search_value, items, Permission, current_user) }}
    {% if items %}
     <div class="pagination">
    {{ macros.render_pagination(pagination, '.setting', search=search_value) }}
    </div>
    {% endif %}
  {% else %}
    <div class="alert alert-info" role="alert">提示：当前用户没有权限</div>
  {% endif %}
  </div>
{% endblock %}
{% block js %}
  <script src="{{ url_for('static', filename='js/idcms.js') }}"></script>
{% endblock %}
